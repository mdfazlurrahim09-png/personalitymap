<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶§‡ßç‡¶¨‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞: ‡ßß‡ß¨‡¶ü‡¶ø ‡¶ß‡¶∞‡¶® (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)</title>
    <!-- Load Tailwind CSS CDN for single file build -->
    <!-- This is the single largest external resource, loading it first is necessary -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- OPTIMIZATION: Load critical Bengali font (Noto Sans Bengali) and Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+Bengali:wght@100..900&display=swap" rel="stylesheet">
    
    <!-- Configure Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#113E40', // Deep Teal/Indigo for background
                        'primary-light': '#D6F6F6', // Light Teal accent
                        'secondary-yellow': '#FFD700', // Gold/Yellow for accents
                        'text-light': '#F0F9FA',
                        'role-analyst': '#1E40AF',   // Dark Blue
                        'role-diplomat': '#059669',  // Emerald Green
                        'role-sentinel': '#FBBF24',  // Amber Yellow
                        'role-explorer': '#DC2626',  // Red
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans Bengali', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* CRITICAL CSS for immediate display */
        body {
            background-color: #113E40; 
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-card {
            background-color: #1A4D50;
            border: 1px solid #2C6E70;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            max-width: 95%; /* Responsive width */
        }
        
        /* Optimized Transition for Perceived Speed */
        .question-content {
            opacity: 1;
            transform: translateX(0);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .animate-out {
            opacity: 0;
            transform: translateX(-20px);
        }

        /* Responsive Scale Container - Crucial for mobile responsiveness */
        .scale-container { 
            padding: 0; 
            margin-top: 2rem;
            display: flex;
            justify-content: space-between; /* Ensures equal spacing */
            gap: 0.25rem; /* Smaller gap for mobile */
        }
        
        .scale-button {
            flex-grow: 1; /* Makes buttons use all available width */
            width: 13%; 
            height: 45px; /* Slightly smaller height for mobile */
            font-size: 0.9rem; /* Smaller font for mobile */
            font-weight: 700;
            border-radius: 0.5rem; 
            background: #236569; 
            color: #D6F6F6; 
            transition: all 0.1s ease;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2), 
                inset 0 -1px 0 rgba(0, 0, 0, 0.2), 
                0 4px 0 #1A4D50; 
        }
        
        .scale-button.selected {
            background: #FFD700; 
            color: #113E40; 
            transform: translateY(4px); 
            box-shadow: 
                inset 0 0 10px rgba(0, 0, 0, 0.5), 
                0 0 0 #1A4D50; 
            font-weight: 900;
        }

        /* Ensure better button size on tablet/desktop */
        @media (min-width: 768px) {
            .scale-button {
                height: 50px;
                font-size: 1.125rem;
            }
        }

        .usage-counter-box { background-color: #2C6E70; padding: 0.25rem 0.5rem; border-radius: 0.75rem; font-size: 0.75rem; color: #ccc; margin-top: 1rem; box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.6); }
        .usage-counter-number { font-size: 0.875rem; color: #FFD700; font-weight: 700; margin-left: 0.25rem; }
        
        /* New Styles for Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }
        .modal-show {
            opacity: 1;
        }
        .modal-content {
            background-color: #1A4D50;
            padding: 2rem;
            border-radius: 1.5rem;
            max-width: 450px;
            width: 90%;
            border: 2px solid #2C6E70;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease-out;
        }
        .modal-show .modal-content {
            transform: scale(1);
        }
        
        #score-description {
            min-height: 20px; 
            transition: color 0.3s, opacity 0.3s;
        }
        
        .result-card { 
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.3); 
            /* Ensure fast opacity transition for results to appear quickly */
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }
    </style>
</head>
<body class="font-sans text-text-light p-4 relative">

    <!-- THE STEALTH 'A' BUTTON - ALMOST INVISIBLE 'A' (Only 5% opacity) -->
    <button id="admin-toggle-btn" 
            onclick="goToAdminLogin()" 
            class="fixed top-2 right-2 z-50 
                   p-1 bg-transparent text-primary-light/5 text-xs font-extrabold 
                   hover:text-primary-light/20 hover:bg-primary-light/5 transition 
                   shadow-none hidden cursor-pointer" 
            aria-label="Admin Login">A</button>

    <div id="app" class="w-full max-w-4xl main-card rounded-3xl p-6 md:p-10 my-8">
        <!-- Initial loading state for extreme speed -->
        <p class="text-center text-sm text-gray-400">Loading...</p>
    </div>
    
    <div id="modal-container"></div>
    
    <script type="module">
        // --- FIREBASE IMPORTS AND SETUP (Load Asynchronously) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, getDoc, setLogLevel, collection, addDoc, query, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- GLOBAL CONFIGS (Immediate Access) ---
        let app, db, auth;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const COUNTER_COLLECTION = `artifacts/${appId}/public/data/usage_counter`;
        const FEEDBACK_COLLECTION = `artifacts/${appId}/public/data/feedback_entries`;
        const COUNTER_DOC_PATH = 'global_count';
        // SECURE ADMIN CREDENTIALS (Must be updated in a real deployment)
        const ADMIN_USERNAME = 'html_admin_2025'; 
        const ADMIN_PASSWORD = 'html_admin_2025';
        
        // --- DATA (Immediate Access) ---
        const QUESTIONS = [
            { id: 1, text: "‡¶∏‡¶æ‡¶Æ‡¶æ‡¶ú‡¶ø‡¶ï ‡¶Ö‡¶®‡ßÅ‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá, ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶π‡¶ú‡ßá‡¶á ‡¶Ö‡¶®‡ßá‡¶ï ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Æ‡¶ø‡¶∂‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶•‡ßã‡¶™‡¶ï‡¶•‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßá‡¶®‡•§", dimension: 'E', polarity: 1 },
            { id: 2, text: "‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶ø‡¶¶‡ßç‡¶ß‡¶æ‡¶®‡ßç‡¶§ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨ ‡¶™‡¶∞‡¶ø‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£‡¶ø‡¶§ ‡¶§‡¶•‡ßç‡¶Ø‡ßá‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡¶∞ ‡¶ï‡¶∞‡ßá‡¶®, ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶æ‡¶® ‡¶®‡ßü‡•§", dimension: 'S', polarity: 1 },
            { id: 3, text: "‡¶Ö‡¶®‡ßç‡¶Ø‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶≠‡ßÇ‡¶§‡¶ø‡¶§‡ßá ‡¶Ü‡¶ò‡¶æ‡¶§ ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶è‡¶Æ‡¶® ‡¶∏‡¶§‡ßç‡¶Ø ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¶‡ßç‡¶¨‡¶ø‡¶ß‡¶æ ‡¶ï‡¶∞‡ßá‡¶® ‡¶®‡¶æ‡•§", dimension: 'T', polarity: 1 },
            { id: 4, text: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßà‡¶®‡¶®‡ßç‡¶¶‡¶ø‡¶® ‡¶ú‡ßÄ‡¶¨‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶∞‡¶ø‡¶ï‡¶≤‡ßç‡¶™‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÇ‡¶ö‡ßÄ ‡¶Æ‡ßá‡¶®‡ßá ‡¶ö‡¶≤‡¶æ‡¶á ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶Ü‡¶∞‡¶æ‡¶Æ‡¶¶‡¶æ‡ßü‡¶ï‡•§", dimension: 'J', polarity: 1 },
            { id: 5, text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º‡¶∂‡¶á ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡¶ï‡ßá ‡¶Ü‡¶∂‡ßá‡¶™‡¶æ‡¶∂‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨‡¶§‡¶æ‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶ß‡¶æ‡¶∞‡¶£‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶≤‡ßç‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶æ‡¶ú‡ßç‡¶Ø‡ßá ‡¶π‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡ßá‡¶§‡ßá ‡¶¶‡ßá‡¶®‡•§", dimension: 'S', polarity: -1 },
            { id: 6, text: "‡¶¶‡ßÄ‡¶∞‡ßç‡¶ò ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶è‡¶ï‡¶æ ‡¶ï‡¶æ‡¶ü‡¶æ‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∂‡¶ï‡ßç‡¶§‡¶ø ‡¶ï‡¶Æ‡ßá ‡¶Ø‡¶æ‡¶Ø‡¶º ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡ßç‡¶≤‡¶æ‡¶®‡ßç‡¶§ ‡¶¨‡ßã‡¶ß ‡¶ï‡¶∞‡ßá‡¶®‡•§", dimension: 'E', polarity: 1 },
            { id: 7, text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶¨‡ßá‡¶ó‡¶™‡ßç‡¶∞‡¶¨‡¶£ ‡¶∏‡¶ø‡¶¶‡ßç‡¶ß‡¶æ‡¶®‡ßç‡¶§‡ßá‡¶∞ ‡¶ö‡ßá‡ßü‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡¶∞ ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£‡¶ï‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶ï‡¶∞‡ßá‡¶®‡•§", dimension: 'T', polarity: 1 },
            { id: 8, text: "‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶¨‡¶æ ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡ßç‡¶¨‡¶ö‡ßç‡¶õ‡¶®‡ßç‡¶¶ ‡¶¨‡ßã‡¶ß ‡¶ï‡¶∞‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∂‡ßá‡¶∑ ‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§ ‡¶ú‡¶æ‡¶®‡¶æ‡¶®‡•§", dimension: 'J', polarity: -1 },
            { id: 9, text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º‡¶∂‡¶á ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶∞‡¶™‡¶æ‡¶∂‡ßá ‡¶ï‡ßÄ ‡¶ò‡¶ü‡¶õ‡ßá ‡¶§‡¶æ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶™‡¶∞‡ßç‡¶Ø‡¶¨‡ßá‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶õ‡ßã‡¶ü ‡¶¨‡¶ø‡¶∑‡ßü‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ñ‡ßá‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ï‡¶∞‡ßá‡¶®‡•§", dimension: 'S', polarity: 1 },
            { id: 10, text: "‡¶¨‡¶ø‡¶§‡¶∞‡ßç‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º, ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡¶®‡ßç‡¶Ø‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶≠‡ßÇ‡¶§‡¶ø ‡¶¨‡¶ø‡¶¨‡ßá‡¶ö‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶≤‡ßã‡¶ö‡¶®‡¶æ‡¶ï‡ßá ‡¶®‡¶∞‡¶Æ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßá‡¶®‡•§", dimension: 'T', polarity: -1 },
            { id: 11, text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶ø‡¶∂‡¶¶ ‡¶™‡¶∞‡¶ø‡¶ï‡¶≤‡ßç‡¶™‡¶®‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶ö‡ßá‡¶ï‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶õ‡¶®‡ßç‡¶¶ ‡¶ï‡¶∞‡ßá‡¶®‡•§", dimension: 'J', polarity: 1 },
            { id: 12, text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶Ö‡¶≠‡ßç‡¶Ø‡¶®‡ßç‡¶§‡¶∞‡ßÄ‡¶£ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ‡¶≠‡¶æ‡¶¨‡¶®‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶®‡ßÅ‡¶≠‡ßÇ‡¶§‡¶ø‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶Æ‡¶®‡ßã‡¶Ø‡ßã‡¶ó ‡¶¶‡ßá‡¶®‡•§", dimension: 'E', polarity: -1 },
            { id: 13, text: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶¨‡¶æ ‡¶∏‡¶π‡¶ï‡¶∞‡ßç‡¶Æ‡ßÄ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º‡¶∂‡¶á ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ö‡¶æ‡¶® ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶π‡¶æ‡¶®‡ßÅ‡¶≠‡ßÇ‡¶§‡¶ø‡¶∂‡ßÄ‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶§‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ï‡¶•‡¶æ ‡¶Æ‡¶®‡ßã‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡ßü‡ßá ‡¶∂‡ßã‡¶®‡ßá‡¶®‡•§", dimension: 'T', polarity: -1 },
            { id: 14, text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶π‡¶†‡¶æ‡ßé ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶¨‡¶Ç ‡¶™‡¶•‡ßá ‡¶™‡¶∞‡¶ø‡¶ï‡¶≤‡ßç‡¶™‡¶®‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶õ‡¶®‡ßç‡¶¶ ‡¶ï‡¶∞‡ßá‡¶®‡•§", dimension: 'J', polarity: -1 },
            { id: 15, text: "‡¶≠‡¶¨‡¶ø‡¶∑‡ßç‡¶Ø‡ßé ‡¶®‡¶ø‡ßü‡ßá ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶Æ‡¶®‡ßã‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶õ‡¶®‡ßç‡¶¶ ‡¶ï‡¶∞‡ßá‡¶®‡•§", dimension: 'S', polarity: 1 },
            { id: 16, text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶¶‡¶≤‡¶ó‡¶§ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶ö‡ßá‡ßü‡ßá ‡¶è‡¶ï‡¶æ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá‡¶á ‡¶¨‡ßá‡¶∂‡¶ø ‡¶∏‡ßç‡¶¨‡¶ö‡ßç‡¶õ‡¶®‡ßç‡¶¶‡•§", dimension: 'E', polarity: -1 },
            { id: 17, text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶á‡¶Ø‡¶º‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶®‡¶æ ‡¶™‡¶°‡¶º‡ßá‡¶ì ‡¶è‡¶∞ ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶ß‡¶æ‡¶∞‡¶£‡¶æ‡¶ü‡¶ø ‡¶¨‡ßÅ‡¶ù‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§", dimension: 'S', polarity: -1 },
            { id: 18, text: "‡¶Ö‡¶®‡ßç‡¶Ø‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶¨‡ßá‡¶¶‡¶®‡¶∂‡ßÄ‡¶≤ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ñ‡ßÅ‡¶¨ ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡•§", dimension: 'T', polarity: -1 },
            { id: 19, text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º‡¶∂‡¶á ‡¶®‡¶ø‡¶ú‡ßá‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶∂‡ßá‡¶∑ ‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶®‡•§", dimension: 'J', polarity: -1 },
            { id: 20, text: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶ï‡¶∞‡ßá‡¶® ‡¶Ø‡ßá ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º ‡¶∏‡¶¨‡¶ï‡¶ø‡¶õ‡ßÅ‡¶∞‡¶á ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§", dimension: 'T', polarity: 1 },
        ];
        
        const SCORE_VALUES = [-3, -2, -1, 0, 1, 2, 3];
        const SCALE_LABELS_SHORT = ["-‡ß©", "-‡ß®", "-‡ßß", "‡ß¶", "+‡ßß", "+‡ß®", "+‡ß©"];
        const SCORE_DESCRIPTIONS = [
            { text: "‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¶‡ßç‡¶¨‡¶ø‡¶Æ‡¶§‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶è‡¶á ‡¶¨‡¶ï‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡¶ø‡¶≤ ‡¶®‡ßá‡¶á‡•§", color: 'text-red-400' },
            { text: "‡¶¶‡ßÉ‡¶¢‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶¶‡ßç‡¶¨‡¶ø‡¶Æ‡¶§‡•§ ‡¶è‡¶á ‡¶¨‡¶ï‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶ø‡¶≤ ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø‡¶á‡•§", color: 'text-red-300' },
            { text: "‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶¶‡ßç‡¶¨‡¶ø‡¶Æ‡¶§‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ü‡¶æ ‡¶¶‡ßç‡¶¨‡¶ø‡¶Æ‡¶§ ‡¶™‡ßã‡¶∑‡¶£ ‡¶ï‡¶∞‡ßá‡¶®‡•§", color: 'text-red-200' },
            { text: "‡¶®‡¶ø‡¶∞‡¶™‡ßá‡¶ï‡ßç‡¶∑‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Æ‡¶§ ‡¶®‡ßá‡¶á ‡¶¨‡¶æ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶Ö‡¶™‡ßç‡¶∞‡¶æ‡¶∏‡¶ô‡ßç‡¶ó‡¶ø‡¶ï‡•§", color: 'text-gray-400' },
            { text: "‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶Æ‡¶§‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ü‡¶æ ‡¶è‡¶ï‡¶Æ‡¶§ ‡¶™‡ßã‡¶∑‡¶£ ‡¶ï‡¶∞‡ßá‡¶®‡•§", color: 'text-green-200' },
            { text: "‡¶¶‡ßÉ‡¶¢‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶ï‡¶Æ‡¶§‡•§ ‡¶è‡¶á ‡¶¨‡¶ï‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü ‡¶Æ‡¶ø‡¶≤ ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§", color: 'text-green-300' },
            { text: "‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶è‡¶ï‡¶Æ‡¶§‡•§ ‡¶è‡¶á ‡¶¨‡¶ï‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶¶‡¶Æ ‡¶∏‡¶†‡¶ø‡¶ï‡•§", color: 'text-green-400' },
        ];
        
        const PERSONALITY_TYPES = {
            INTJ: { name: "‡¶∏‡ßç‡¶•‡¶™‡¶§‡¶ø", emoji: "üß†", type: "INTJ", role: "Analyst", description: "‡¶¶‡ßÇ‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡ßÄ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ‡¶¨‡¶ø‡¶¶, ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶∏‡¶¨‡¶ï‡¶ø‡¶õ‡ßÅ‡¶§‡ßá‡¶á ‡¶â‡¶®‡ßç‡¶®‡¶§‡¶ø ‡¶Ü‡¶®‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶ï‡¶≤‡ßç‡¶™‡¶®‡¶æ ‡¶ï‡¶∞‡ßá‡¶®‡•§ ‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡ßÅ‡¶≤‡¶§‡¶æ ‡¶§‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Æ‡ßÇ‡¶≤ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡•§" },
            INTP: { name: "‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶¨‡¶ø‡¶¶", emoji: "üí°", type: "INTP", role: "Analyst", description: "‡¶â‡¶¶‡ßç‡¶≠‡¶æ‡¶¨‡¶®‡ßÄ, ‡¶ú‡¶ü‡¶ø‡¶≤ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®‡ßá ‡¶Ü‡¶ó‡ßç‡¶∞‡¶π‡ßÄ ‡¶è‡¶¨‡¶Ç ‡¶ú‡ßç‡¶û‡¶æ‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶§‡ßÉ‡¶∑‡ßç‡¶£‡¶æ‡¶∞‡ßç‡¶§‡•§ ‡¶∏‡¶∞‡ßç‡¶¨‡¶¶‡¶æ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ß‡¶æ‡¶∞‡¶£‡¶æ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ-‡¶®‡¶ø‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá‡¶®‡•§" },
            ENTJ: { name: "‡¶∏‡ßá‡¶®‡¶æ‡¶™‡¶§‡¶ø", emoji: "üëë", type: "ENTJ", role: "Analyst", description: "‡¶∏‡¶æ‡¶π‡¶∏‡ßÄ, ‡¶ï‡¶≤‡ßç‡¶™‡¶®‡¶æ‡¶¨‡¶ø‡¶≤‡¶æ‡¶∏‡ßÄ ‡¶è‡¶¨‡¶Ç ‡¶¶‡ßÉ‡¶¢‡¶º ‡¶á‡¶ö‡ßç‡¶õ‡¶æ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶®‡ßá‡¶§‡¶æ, ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø ‡¶Ö‡¶∞‡ßç‡¶ú‡¶®‡ßá‡¶∞ ‡¶™‡¶• ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶®‡ßá‡¶®‡•§" },
            ENTP: { name: "‡¶¨‡¶ø‡¶§‡¶∞‡ßç‡¶ï‡¶ï‡¶æ‡¶∞‡ßÄ", emoji: "‚öîÔ∏è", type: "ENTP", role: "Analyst", description: "‡¶¨‡ßÅ‡¶¶‡ßç‡¶ß‡¶ø‡¶Æ‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßå‡¶§‡ßÇ‡¶π‡¶≤‡ßÄ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ‡¶¨‡¶ø‡¶¶ ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶¨‡ßÅ‡¶¶‡ßç‡¶ß‡¶ø‡¶¨‡ßÉ‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú ‡¶™‡¶õ‡¶®‡ßç‡¶¶ ‡¶ï‡¶∞‡ßá‡¶®‡•§" },
            INFJ: { name: "‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂‡¶¶‡¶æ‡¶§‡¶æ", emoji: "üïäÔ∏è", type: "INFJ", role: "Diplomat", description: "‡¶∂‡¶æ‡¶®‡ßç‡¶§ ‡¶™‡ßç‡¶∞‡¶ï‡ßÉ‡¶§‡¶ø‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶π‡¶∏‡ßç‡¶Ø‡¶Æ‡¶Ø‡¶º, ‡¶§‡¶¨‡ßÅ‡¶ì ‡¶Ö‡¶®‡ßÅ‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶£‡¶æ‡¶¶‡¶æ‡ßü‡¶ï ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶ï‡ßç‡¶≤‡¶æ‡¶®‡ßç‡¶§ ‡¶Ü‡¶¶‡¶∞‡ßç‡¶∂‡¶¨‡¶æ‡¶¶‡ßÄ‡•§ ‡¶§‡¶æ‡¶∞‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®‡•§" },
            INFP: { name: "‡¶Æ‡¶ß‡ßç‡¶Ø‡¶∏‡ßç‡¶•‡¶§‡¶æ‡¶ï‡¶æ‡¶∞‡ßÄ", emoji: "ü¶ã", type: "INFP", role: "Diplomat", description: "‡¶∂‡¶æ‡¶®‡ßç‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§, ‡¶§‡¶¨‡ßá ‡¶¶‡ßÉ‡¶¢‡¶º ‡¶®‡ßà‡¶§‡¶ø‡¶ï‡¶§‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡¶¨‡ßã‡¶ß ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶ø‡¶§‡•§ ‡¶§‡¶æ‡¶∞‡¶æ ‡¶ó‡¶≠‡ßÄ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶• ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡ßá‡¶®‡•§" },
            ENFJ: { name: "‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶ï", emoji: "‚ú®", type: "ENFJ", role: "Diplomat", description: "‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡¶Ø‡¶º, ‡¶Ö‡¶®‡ßÅ‡¶™‡ßç‡¶∞‡¶æ‡¶£‡¶ø‡¶§‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶®‡ßá‡¶§‡¶æ ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø‡¶¶‡ßá‡¶∞ ‡¶≠‡¶æ‡¶≤‡ßã ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Æ‡¶æ‡¶ú‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶¨‡¶æ‡¶ö‡¶ï ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶Ü‡¶®‡ßá‡¶®‡•§" },
            ENFP: { name: "‡¶™‡ßç‡¶∞‡¶ö‡¶æ‡¶∞‡¶ï", emoji: "üåà", type: "ENFP", role: "Diplomat", description: "‡¶â‡¶¶‡ßç‡¶Ø‡¶Æ‡ßÄ, ‡¶∏‡ßÉ‡¶ú‡¶®‡¶∂‡ßÄ‡¶≤, ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶ú‡¶ø‡¶ï ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§ ‡¶Æ‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑‡•§ ‡¶§‡¶æ‡¶∞‡¶æ ‡¶ú‡ßÄ‡¶¨‡¶®‡¶ï‡ßá ‡¶∏‡ßÅ‡¶Ø‡ßã‡¶ó ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶¶‡ßá‡¶ñ‡ßá‡¶®‡•§" },
            ISTJ: { name: "‡¶≤‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶ø‡¶ï‡¶ø‡¶Ø‡¶º‡¶æ‡¶®", emoji: "üèõÔ∏è", type: "ISTJ", role: "Sentinel", description: "‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨‡¶¨‡¶æ‡¶¶‡ßÄ ‡¶è‡¶¨‡¶Ç ‡¶§‡¶•‡ßç‡¶Ø-‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑ ‡¶Ø‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶§‡¶§‡¶æ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶§‡ßã‡¶≤‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶ï‡¶æ‡¶∂ ‡¶®‡ßá‡¶á‡•§ ‡¶§‡¶æ‡¶∞‡¶æ ‡¶ï‡¶∞‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡¶™‡¶∞‡¶æ‡¶Ø‡¶º‡¶£ ‡¶ì ‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡¶∞‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡•§" },
            ISFJ: { name: "‡¶∞‡¶ï‡ßç‡¶∑‡¶ï", emoji: "üõ°Ô∏è", type: "ISFJ", role: "Sentinel", description: "‡¶â‡¶§‡ßç‡¶∏‡¶∞‡ßç‡¶ó‡ßÄ‡¶ï‡ßÉ‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶â‡¶∑‡ßç‡¶£ ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ‡¶ï‡¶æ‡¶∞‡ßÄ, ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶§‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶ú‡¶®‡¶¶‡ßá‡¶∞ ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§ ‡¶§‡¶æ‡¶∞‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶∏‡ßç‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Ç‡¶¨‡ßá‡¶¶‡¶®‡¶∂‡ßÄ‡¶≤‡•§" },
            ESTJ: { name: "‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶π‡ßÄ", emoji: "üíº", type: "ESTJ", role: "Sentinel", description: "‡¶¶‡¶æ‡¶∞‡ßç‡¶∂‡¶®‡¶ø‡¶ï, ‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡¶æ‡¶∏‡¶ï, ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶ú‡¶ø‡¶®‡¶ø‡¶∏‡¶™‡¶§‡ßç‡¶∞ ‡¶ó‡ßÅ‡¶õ‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶®‡¶§‡ßá ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶õ‡¶®‡ßç‡¶¶ ‡¶ï‡¶∞‡ßá‡¶®‡•§" },
            ESFJ: { name: "‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂‡¶¶‡¶æ‡¶§‡¶æ", emoji: "ü§ù", type: "ESFJ", role: "Sentinel", description: "‡¶Ö‡¶§‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶Ø‡¶§‡ßç‡¶®‡¶∂‡ßÄ‡¶≤, ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶ú‡¶ø‡¶ï ‡¶è‡¶¨‡¶Ç ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Æ‡¶ø‡¶∂‡¶§‡ßá ‡¶Ü‡¶ó‡ßç‡¶∞‡¶π‡ßÄ‡•§ ‡¶§‡¶æ‡¶∞‡¶æ ‡¶∏‡¶Æ‡¶æ‡¶ú‡¶∏‡ßá‡¶¨‡¶æ‡¶Ø‡¶º ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡•§" },
            ISTP: { name: "‡¶ó‡ßÅ‡¶£‡ßÄ", emoji: "üõ†Ô∏è", type: "ISTP", role: "Explorer", description: "‡¶∏‡¶æ‡¶π‡¶∏‡ßÄ, ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ø‡¶ï ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶ï ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶π‡¶æ‡¶§‡ßá-‡¶ï‡¶≤‡¶Æ‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶¨‡¶Ç ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶õ‡¶®‡ßç‡¶¶ ‡¶ï‡¶∞‡ßá‡¶®‡•§" },
            ISFP: { name: "‡¶Ö‡¶≠‡¶ø‡¶Ø‡¶æ‡¶§‡ßç‡¶∞‡ßÄ", emoji: "üé®", type: "ISFP", role: "Explorer", description: "‡¶®‡¶Æ‡¶®‡ßÄ‡¶Ø‡¶º, ‡¶Æ‡¶®‡ßã‡¶Æ‡ßÅ‡¶ó‡ßç‡¶ß‡¶ï‡¶∞ ‡¶∂‡¶ø‡¶≤‡ßç‡¶™‡ßÄ ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶∏‡¶∞‡ßç‡¶¨‡¶¶‡¶æ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶Ü‡¶¨‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§ ‡¶§‡¶æ‡¶∞‡¶æ ‡¶®‡¶ø‡¶ú‡ßá‡¶¶‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶ï‡¶∞‡ßá ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶Ø‡¶æ‡¶™‡¶® ‡¶ï‡¶∞‡ßá‡¶®‡•§" },
            ESTP: { name: "‡¶â‡¶¶‡ßç‡¶Ø‡ßã‡¶ó‡ßÄ", emoji: "üöÄ", type: "ESTP", role: "Explorer", description: "‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü, ‡¶â‡¶¶‡ßç‡¶Ø‡¶Æ‡ßÄ ‡¶è‡¶¨‡¶Ç ‡¶ñ‡ßÅ‡¶¨ ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß‡¶ø‡¶™‡ßç‡¶∞‡¶¨‡¶£ ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑ ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø ‡¶®‡¶ø‡¶§‡ßá ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶∂‡ßá‡¶ñ‡ßá‡¶®‡•§" },
            ESFP: { name: "‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®‡¶¶‡¶æ‡¶§‡¶æ", emoji: "üé≠", type: "ESFP", role: "Explorer", description: "‡¶∏‡ßç‡¶¨‡¶§‡¶É‡¶∏‡ßç‡¶´‡ßÇ‡¶∞‡ßç‡¶§, ‡¶â‡¶¶‡ßç‡¶Ø‡¶Æ‡ßÄ ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶æ‡¶£‡¶¨‡¶®‡ßç‡¶§ ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑ - ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá‡¶á ‡¶Ø‡¶æ‡¶®, ‡¶∏‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶®‡¶®‡ßç‡¶¶ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶∏‡ßá‡¶®‡•§ ‡¶§‡¶æ‡¶∞‡¶æ ‡¶≤‡¶æ‡¶á‡¶Æ‡¶≤‡¶æ‡¶á‡¶ü ‡¶™‡¶õ‡¶®‡ßç‡¶¶ ‡¶ï‡¶∞‡ßá‡¶®‡•§" },
        };
        
        const ROLE_COLORS = {
            'Analyst': 'role-analyst',
            'Diplomat': 'role-diplomat',
            'Sentinel': 'role-sentinel',
            'Explorer': 'role-explorer',
        };

        const DIMENSION_LABELS = {
            E: '‡¶¨‡¶π‡¶ø‡¶∞‡ßç‡¶Æ‡ßÅ‡¶ñ‡ßÄ‡¶§‡¶æ (Extraversion)', I: '‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶Æ‡ßÅ‡¶ñ‡ßÄ‡¶§‡¶æ (Introversion)',
            S: '‡¶∏‡¶Ç‡¶¨‡ßá‡¶¶‡¶® (Sensing)', N: '‡¶∏‡ßç‡¶¨‡¶ú‡ßç‡¶û‡¶æ (Intuition)',
            T: '‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ‡¶≠‡¶æ‡¶¨‡¶®‡¶æ (Thinking)', F: '‡¶Ö‡¶®‡ßÅ‡¶≠‡ßÇ‡¶§‡¶ø (Feeling)',
            J: '‡¶¨‡¶ø‡¶ö‡¶æ‡¶∞‡¶ï (Judging)', P: '‡¶™‡¶∞‡ßç‡¶Ø‡¶¨‡ßá‡¶ï‡ßç‡¶∑‡¶£ (Prospecting)',
        };


        // --- APPLICATION STATE & CORE LOGIC ---
        let state = {
            view: 'welcome',
            currentQuestionIndex: 0,
            answers: new Array(QUESTIONS.length).fill(null),
            isQuizFinished: false,
            finalResult: null,
            firebaseInitialized: false,
            totalUses: 0, 
            userId: null,
            isAdminLoggedIn: false,
            feedbackList: [],
            dynamicScoreDescription: null,
            dynamicScoreColor: 'text-gray-400',
        };

        const appDiv = document.getElementById('app');
        const modalContainer = document.getElementById('modal-container');
        let isAnimating = false;
        let unsubscribeFeedback = null;

        // --- UTILITY FUNCTIONS ---
        // Keeping these functions as data is still saved in Firestore, just not displayed
        function parseUserAgent(userAgent) {
            if (!userAgent) return '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏';
            userAgent = userAgent.toLowerCase();
            let os = 'Unknown OS';
            if (userAgent.includes('windows')) os = 'Windows';
            else if (userAgent.includes('android')) os = 'Android';
            else if (userAgent.includes('iphone') || userAgent.includes('ipad')) os = 'iOS/iPadOS';
            else if (userAgent.includes('macintosh')) os = 'macOS';
            else if (userAgent.includes('linux')) os = 'Linux';
            let deviceType = 'Desktop';
            if (userAgent.includes('mobile') || userAgent.includes('android')) deviceType = 'Mobile';
            else if (userAgent.includes('ipad') || (os === 'Android' && !userAgent.includes('mobile'))) deviceType = 'Tablet';
            return `${deviceType} (${os})`;
        }

        function getLocaleDetails(localeInfo) {
            if (!localeInfo) return { flag: 'üåç', name: '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶Ö‡¶û‡ßç‡¶ö‡¶≤' };
            const parts = localeInfo.split('-');
            const countryCode = (parts.length > 1 ? parts[1] : parts[0]).toUpperCase();
            
            const map = {
                'BD': { flag: 'üáßüá©', name: '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂' }, 'IN': { flag: 'üáÆüá≥', name: '‡¶≠‡¶æ‡¶∞‡¶§' }, 
                'PK': { flag: 'üáµüá∞', name: '‡¶™‡¶æ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶®' }, 'US': { flag: 'üá∫üá∏', name: '‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶ø‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶∞‡¶æ‡¶∑‡ßç‡¶ü‡ßç‡¶∞' },
                'GB': { flag: 'üá¨üáß', name: '‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶∞‡¶æ‡¶ú‡ßç‡¶Ø' }, 'AU': { flag: 'üá¶üá∫', name: '‡¶Ö‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ' },
                'CA': { flag: 'üá®üá¶', name: '‡¶ï‡¶æ‡¶®‡¶æ‡¶°‡¶æ' }, 'DE': { flag: 'üá©üá™', name: '‡¶ú‡¶æ‡¶∞‡ßç‡¶Æ‡¶æ‡¶®‡¶ø' },
                'FR': { flag: 'üá´üá∑', name: '‡¶´‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏' }, 'JP': { flag: 'üáØüáµ', name: '‡¶ú‡¶æ‡¶™‡¶æ‡¶®' },
                'KR': { flag: 'üá∞üá∑', name: '‡¶¶‡¶ï‡ßç‡¶∑‡¶ø‡¶£ ‡¶ï‡ßã‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ' }, 'CN': { flag: 'üá®üá≥', name: ' ‡¶ö‡ßÄ‡¶®' },
            };
            
            const result = map[countryCode];
            if (result) return result;
            
            const langCode = parts[0].toUpperCase();
            if (map[langCode]) return { ...map[langCode], name: `${map[langCode].name} (Locale: ${localeInfo})` };

            return { flag: 'üåç', name: `‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ (${localeInfo})` }; 
        }

        function getDeviceInfo() {
            return {
                userAgent: navigator.userAgent,
                language: navigator.language,
                screenWidth: window.screen.width,
                screenHeight: window.screen.height
            };
        }

        // --- FIREBASE AND AUTH FUNCTIONS ---
        // OPTIMIZATION: Ensure this is non-blocking to the initial render
        async function initializeFirebase() {
            if (!firebaseConfig) {
                console.error("Firebase config is missing.");
                state.firebaseInitialized = true; // Mark as initialized to stop trying
                render(); 
                return;
            }
            
            try {
                // setLogLevel('Debug'); // Disable debug logging by default for speed
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Use a non-blocking listener for auth state
                onAuthStateChanged(auth, async (user) => {
                    if (!user) {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } 
                    // This second check ensures the userId is always set after any sign-in attempt
                    if (auth.currentUser) {
                        state.userId = auth.currentUser.uid || crypto.randomUUID();
                    } else {
                        state.userId = crypto.randomUUID();
                    }
                    
                    if (!state.firebaseInitialized) {
                        state.firebaseInitialized = true;
                        setupCounterListener();
                        render(); // Re-render only when auth is confirmed and counter is setup
                    }
                });

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                state.firebaseInitialized = true;
                appDiv.innerHTML = `<div class="text-center p-8 text-red-400">‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</div>`;
            }
        }

        function setupCounterListener() {
            if (!state.firebaseInitialized) return;
            const counterRef = doc(db, COUNTER_COLLECTION, COUNTER_DOC_PATH);
            onSnapshot(counterRef, (docSnap) => {
                let currentCount = 0;
                if (docSnap.exists()) {
                    currentCount = docSnap.data().count || 0;
                }
                state.totalUses = currentCount;
                // Re-render only if admin dashboard is open to update the counter
                if (state.view === 'admin_dashboard') render(); 
            }, (error) => {
                console.error("Error setting up counter listener:", error);
            });
        }
        
        async function updateUsageCounter() {
            if (!state.firebaseInitialized || !db) return;
            try {
                const counterRef = doc(db, COUNTER_COLLECTION, COUNTER_DOC_PATH);
                const snapshot = await getDoc(counterRef); 
                let currentCount = 0;
                if (snapshot.exists()) {
                    currentCount = snapshot.data().count || 0;
                }
                await setDoc(counterRef, { 
                    count: currentCount + 1,
                    last_updated: new Date().toISOString()
                }, { merge: true });
            } catch (error) {
                console.error("Error updating usage counter:", error);
            }
        }
        
        // --- QUIZ FLOW FUNCTIONS (Same as before, focused on smooth transitions) ---

        function goToHome() {
            state.view = 'welcome';
            state.answers.fill(null);
            state.currentQuestionIndex = 0;
            state.isQuizFinished = false;
            state.finalResult = null;
            state.dynamicScoreDescription = null;
            state.dynamicScoreColor = 'text-gray-400';
            if (unsubscribeFeedback) {
                unsubscribeFeedback(); 
                unsubscribeFeedback = null;
            }
            state.isAdminLoggedIn = false;
            render();
        }

        function startQuiz() {
            state.view = 'quiz';
            state.isQuizFinished = false;
            state.currentQuestionIndex = 0;
            state.answers.fill(null);
            state.dynamicScoreDescription = null;
            state.dynamicScoreColor = 'text-gray-400';
            render();
        }

        function nextQuestion() {
            if (state.answers[state.currentQuestionIndex] === null || isAnimating) return;
            const contentDiv = document.getElementById('question-content');
            if (contentDiv) {
                isAnimating = true;
                contentDiv.classList.add('animate-out');
            }
            
            setTimeout(() => {
                if (state.currentQuestionIndex < QUESTIONS.length - 1) {
                    state.currentQuestionIndex++;
                    state.dynamicScoreDescription = state.answers[state.currentQuestionIndex] !== null ? SCORE_DESCRIPTIONS[state.answers[state.currentQuestionIndex]].text : null;
                    state.dynamicScoreColor = state.answers[state.currentQuestionIndex] !== null ? SCORE_DESCRIPTIONS[state.answers[state.currentQuestionIndex]].color : 'text-gray-400';
                    render();
                } else {
                    calculateResult();
                }
                isAnimating = false;
            }, 400); // 400ms delay for snappier transition
        }

        function previousQuestion() {
            if (state.currentQuestionIndex === 0 || isAnimating) return;
            const contentDiv = document.getElementById('question-content');
            if (contentDiv) {
                isAnimating = true;
                contentDiv.style.transform = 'translateX(20px)'; 
                contentDiv.classList.add('animate-out');
            }
            
            setTimeout(() => {
                state.currentQuestionIndex--;
                state.dynamicScoreDescription = state.answers[state.currentQuestionIndex] !== null ? SCORE_DESCRIPTIONS[state.answers[state.currentQuestionIndex]].text : null;
                state.dynamicScoreColor = state.answers[state.currentQuestionIndex] !== null ? SCORE_DESCRIPTIONS[state.answers[state.currentQuestionIndex]].color : 'text-gray-400';
                render();
                isAnimating = false;
            }, 400); 
        }

        function selectAnswer(scoreIndex) {
            if (isAnimating) return; 
            
            state.answers[state.currentQuestionIndex] = scoreIndex;
            
            // Update the dynamic score description immediately
            state.dynamicScoreDescription = SCORE_DESCRIPTIONS[scoreIndex].text;
            state.dynamicScoreColor = SCORE_DESCRIPTIONS[scoreIndex].color;
            
            render(); 
            
            if (state.currentQuestionIndex < QUESTIONS.length - 1) {
                setTimeout(() => {
                    nextQuestion();
                }, 300); 
            }
        }

        function calculateResult() {
            const scores = { E: 0, S: 0, T: 0, J: 0 };
            const maxScore = QUESTIONS.length * 3;
            QUESTIONS.forEach((q, index) => {
                const score = SCORE_VALUES[state.answers[index]] * q.polarity;
                scores[q.dimension] += score;
            });
            let resultType = "";
            let finalScores = {};
            const processDimension = (dimA, dimB, score) => {
                const polarity = (score / maxScore) * 100;
                const percentA = Math.round(50 + (polarity / 2));
                const activeType = (score >= 0) ? dimA : dimB;
                return { typeA: dimA, percentA: percentA, typeB: dimB, percentB: 100 - percentA, active: activeType };
            };

            finalScores.EI = processDimension('E', 'I', scores.E);
            finalScores.SN = processDimension('S', 'N', scores.S);
            finalScores.TF = processDimension('T', 'F', scores.T);
            finalScores.JP = processDimension('J', 'P', scores.J);
            
            resultType += finalScores.EI.active;
            resultType += finalScores.SN.active;
            resultType += finalScores.TF.active;
            resultType += finalScores.JP.active;

            state.finalResult = PERSONALITY_TYPES[resultType];
            state.finalScores = finalScores;
            state.isQuizFinished = true;
            state.view = 'result';
            updateUsageCounter();
            render();
        }
        
        // --- FEEDBACK & ADMIN FUNCTIONS ---
        function showFeedbackForm() {
            const html = `
                <div class="modal-overlay modal-show" onclick="hideFeedbackForm(event)">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <h3 class="text-2xl font-bold text-secondary-yellow mb-4">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§ ‡¶¶‡¶ø‡¶®</h3>
                        <p class="text-gray-300 mb-4 text-sm">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶≠‡¶æ‡¶≤‡ßã ‡¶≤‡¶æ‡¶ó‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶ú‡¶æ‡¶®‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§</p>
                        
                        <input type="text" id="feedback-name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-3 mb-3 rounded-lg bg-primary-dark border border-2 border-gray-600 text-text-light focus:border-secondary-yellow outline-none" maxlength="50" />
                        <textarea id="feedback-message" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø" rows="4" class="w-full p-3 mb-6 rounded-lg bg-primary-dark border border-2 border-gray-600 text-text-light focus:border-secondary-yellow outline-none resize-none" required minlength="1"></textarea>
                        
                        <div class="flex justify-end gap-3">
                            <button onclick="hideFeedbackForm()" class="px-5 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                            <button onclick="submitFeedback()" id="submit-feedback-btn" class="px-5 py-2 bg-secondary-yellow text-primary-dark font-bold rounded-lg hover:bg-yellow-400 transition">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
                        </div>
                        <p id="feedback-status" class="mt-4 text-center text-sm text-red-400"></p>
                    </div>
                </div>
            `;
            modalContainer.innerHTML = html;
        }

        function hideFeedbackForm(event) {
            // Only hide if the overlay (parent) is clicked, or if called without event
            if (event && event.target.classList.contains('modal-overlay')) {
                 modalContainer.innerHTML = '';
            } else if (!event) {
                 modalContainer.innerHTML = '';
            }
        }
        
        async function submitFeedback() {
            if (!state.firebaseInitialized || !db) {
                document.getElementById('feedback-status').textContent = '‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶®‡¶Ø‡¶º‡•§ ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
                return;
            }
            
            const nameInput = document.getElementById('feedback-name');
            const messageInput = document.getElementById('feedback-message');
            const statusDiv = document.getElementById('feedback-status');
            const submitBtn = document.getElementById('submit-feedback-btn');

            const name = nameInput.value.trim() || 'Anonymous';
            const message = messageInput.value.trim();
            // Gathering all device info for storage, even if not displayed in admin panel
            const deviceInfo = getDeviceInfo();
            
            if (message.length < 1) {
                statusDiv.textContent = '‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡¶ü‡¶ø ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§';
                return;
            }
            
            statusDiv.textContent = '‡¶ú‡¶Æ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            submitBtn.disabled = true;
            
            try {
                await addDoc(collection(db, FEEDBACK_COLLECTION), {
                    name: name,
                    message: message,
                    timestamp: Date.now(),
                    userId: state.userId,
                    deviceDetails: deviceInfo.userAgent,
                    localeInfo: deviceInfo.language,
                    screenResolution: `${deviceInfo.screenWidth}x${deviceInfo.screenHeight}`
                });
                
                statusDiv.innerHTML = '<span class="text-green-400 font-bold">‚úîÔ∏è ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§</span>';
                
                nameInput.value = '';
                messageInput.value = '';
                
                setTimeout(() => {
                    modalContainer.innerHTML = '';
                }, 2500);

            } catch (error) {
                console.error("Error submitting feedback:", error);
                statusDiv.textContent = '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
                submitBtn.disabled = false;
            }
        }

        function goToAdminLogin() {
            state.view = 'admin_login';
            render();
        }
        
        function loginAdmin() {
            const usernameInput = document.getElementById('admin-username');
            const passwordInput = document.getElementById('admin-password');
            const statusDiv = document.getElementById('admin-status');
            
            const username = usernameInput.value;
            const password = passwordInput.value;

            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                statusDiv.textContent = '‡¶∏‡¶´‡¶≤! ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡¶õ‡ßá...';
                state.isAdminLoggedIn = true;
                state.view = 'admin_dashboard';
                setupFeedbackListener(); 
                render();
            } else {
                statusDiv.textContent = '‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡•§';
            }
        }

        // --- EXPOSE FUNCTIONS GLOBALLY ---
        window.goToHome = goToHome;
        window.startQuiz = startQuiz;
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.selectAnswer = selectAnswer;
        window.showFeedbackForm = showFeedbackForm;
        window.hideFeedbackForm = hideFeedbackForm;
        window.submitFeedback = submitFeedback;
        window.goToAdminLogin = goToAdminLogin;
        window.loginAdmin = loginAdmin;
        
        
        // --- RENDERING VIEWS ---
        
        function renderWelcome() {
            // Usage counter removed from welcome screen as requested
            
            return `
                <div class="text-center p-8 md:p-12 flex flex-col items-center relative">
                    <h1 class="text-5xl md:text-7xl font-extrabold text-secondary-yellow mb-4 leading-tight inline-block p-2 rounded-xl">
                        Personality Map
                    </h1>
                    <p class="text-xl md:text-2xl font-medium text-primary-light mt-4 mb-12">
                        ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶§‡ßç‡¶¨‡ßá‡¶∞ ‡ßß‡ß¨‡¶ü‡¶ø ‡¶ß‡¶∞‡¶® ‡¶ú‡¶æ‡¶®‡ßÅ‡¶®
                    </p>

                    <p class="text-base md:text-lg text-gray-300 mb-8 max-w-lg mx-auto">
                        ‡¶è‡¶á ‡¶ï‡ßÅ‡¶á‡¶ú‡ßá ‡¶Æ‡ßã‡¶ü ‡ß®‡ß¶‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∞‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶∞ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶§‡ßç‡¶¨‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞‡¶≠‡ßá‡¶¶ (‡¶Ø‡ßá‡¶Æ‡¶®: INTJ, ESFP) ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶Æ‡¶§‡¶ø ‡¶¨‡¶æ ‡¶¶‡ßç‡¶¨‡¶ø‡¶Æ‡¶§‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
                    </p>

                    <button
                        onclick="startQuiz()"
                        class="px-10 py-4 bg-secondary-yellow text-primary-dark font-bold text-xl rounded-full shadow-2xl hover:bg-yellow-400 transition transform hover:scale-105"
                    >
                        ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶® ‚Üí
                    </button>
                    
                    <div class="mt-12 w-full text-center text-sm text-gray-500">
                        <span>Developed by Biplob</span>
                    </div>
                </div>
            `;
        }
        
        function renderQuiz() {
            const q = QUESTIONS[state.currentQuestionIndex];
            if (!q) return '';

            const selectedScoreIndex = state.answers[state.currentQuestionIndex];
            const isAnswerSelected = selectedScoreIndex !== null;
            const isLastQuestion = state.currentQuestionIndex === QUESTIONS.length - 1;

            const buttonsHtml = SCALE_LABELS_SHORT.map((label, index) => {
                const isSelected = index === selectedScoreIndex;
                return `
                    <button 
                        onclick="selectAnswer(${index})" 
                        class="scale-button ${isSelected ? 'selected' : ''}" 
                        aria-label="${label}"
                    >
                        ${label}
                    </button>
                `;
            }).join('');
            
            const renderScaleKey = () => `
                <div class="scale-explanation p-3 rounded-xl mb-6 text-sm md:text-base bg-primary-dark border-2 border-secondary-yellow/50">
                    <div class="flex justify-between text-xs md:text-sm text-gray-300">
                        <div class="p-1 text-center font-bold text-red-300">
                            <span class="block text-secondary-yellow text-lg">-‡ß©</span>
                            <span class="block">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¶‡ßç‡¶¨‡¶ø‡¶Æ‡¶§</span>
                        </div>
                        <div class="p-1 text-center font-bold text-gray-400">
                            <span class="block text-secondary-yellow text-lg">‡ß¶</span>
                            <span class="block">‡¶®‡¶ø‡¶∞‡¶™‡ßá‡¶ï‡ßç‡¶∑</span>
                        </div>
                        <div class="p-1 text-center font-bold text-green-300">
                            <span class="block text-secondary-yellow text-lg">+‡ß©</span>
                            <span class="block">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶è‡¶ï‡¶Æ‡¶§</span>
                        </div>
                    </div>
                </div>
            `;
            
            const renderProgress = () => {
                const total = QUESTIONS.length;
                const current = state.currentQuestionIndex + 1;
                const answered = state.answers.filter(a => a !== null).length;
                const completedPercentage = Math.round((answered / total) * 100);
                const progress = (current / total) * 100;

                return `
                    <div class="mb-8 p-3 bg-primary-dark rounded-xl">
                        <div class="text-sm font-semibold text-secondary-yellow mb-2 flex justify-between">
                            <span>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${current} / ${total}</span>
                            <span>${completedPercentage}% ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</span>
                        </div>
                        <div class="w-full bg-[#2C6E70] rounded-full h-3 overflow-hidden">
                            <div class="bg-secondary-yellow h-3 rounded-full transition-all duration-500 ease-in-out" style="width: ${progress}%;"></div>
                        </div>
                    </div>
                `;
            };

            return `
                ${renderProgress()}
                
                <div id="question-content" class="question-content">
                    <h2 class="text-2xl md:text-3xl font-bold text-primary-light mb-8 leading-relaxed">
                        ${q.text}
                    </h2>
                    
                    ${renderScaleKey()}

                    <!-- Responsive Scale Container -->
                    <div class="scale-container">
                        ${buttonsHtml}
                    </div>
                    
                    <!-- Dynamic Score Description -->
                    <div class="text-center mt-6">
                        <p class="text-lg font-bold text-secondary-yellow mb-2">
                           ${isAnswerSelected ? '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®:' : '(‡¶è‡¶ï‡¶ü‡¶ø ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®)'}
                        </p>
                        <p id="score-description" class="text-base font-medium ${state.dynamicScoreColor}">
                            ${state.dynamicScoreDescription || ''}
                        </p>
                    </div>


                </div>

                <div class="mt-10 flex justify-between">
                    <button 
                        onclick="previousQuestion()"
                        class="px-5 py-3 bg-primary-light text-primary-dark font-semibold rounded-xl hover:bg-white transition disabled:opacity-30 disabled:cursor-not-allowed"
                        ${state.currentQuestionIndex === 0 ? 'disabled' : ''}
                    >
                        ‚Üê ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ
                    </button>
                    <button 
                        onclick="nextQuestion()"
                        class="px-8 py-3 bg-secondary-yellow text-primary-dark font-bold text-lg rounded-xl shadow-lg hover:bg-yellow-400 transition disabled:opacity-50 disabled:cursor-not-allowed"
                        ${!isAnswerSelected ? 'disabled' : ''}
                    >
                        ${isLastQuestion ? '‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®' : '‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‚Üí'}
                    </button>
                </div>
                
                <div class="mt-12 text-center text-sm text-gray-500 border-t border-gray-700 pt-4 flex justify-between items-center">
                    <button onclick="goToHome()" class="text-gray-400 hover:text-secondary-yellow transition underline p-1 text-base font-semibold">
                        ‚Üê ‡¶π‡ßã‡¶Æ
                    </button>
                    <span>Developed by Biplob</span>
                </div>
            `;
        }
        
        function renderResult() {
            const result = state.finalResult;
            const scores = state.finalScores;
            if (!result || !scores) return '';
            
            const renderScoreBar = (dimensionData, roleColor) => {
                const isLeftActive = dimensionData.active === dimensionData.typeA;
                return `
                    <div class="mb-6">
                        <div class="flex justify-between mb-2 text-sm md:text-base font-bold">
                            <span class="${isLeftActive ? 'text-secondary-yellow' : 'text-gray-400'}">${DIMENSION_LABELS[dimensionData.typeA]}</span>
                            <span class="${!isLeftActive ? 'text-secondary-yellow' : 'text-gray-400'}">${DIMENSION_LABELS[dimensionData.typeB]}</span>
                        </div>
                        <div class="flex h-3 rounded-full overflow-hidden shadow-inner">
                            <div class="h-full transition-all duration-700 ease-in-out ${isLeftActive ? 'bg-secondary-yellow' : 'bg-gray-700'}" style="width: ${dimensionData.percentA}%;"></div>
                            <div class="h-full transition-all duration-700 ease-in-out ${!isLeftActive ? 'bg-secondary-yellow' : 'bg-gray-700'}" style="width: ${dimensionData.percentB}%;"></div>
                        </div>
                        <div class="flex justify-between mt-1 text-xs text-gray-400 font-medium">
                            <span>${dimensionData.percentA}%</span>
                            <span>${dimensionData.percentB}%</span>
                        </div>
                    </div>
                `;
            };

            const themeColorClass = ROLE_COLORS[result.role];
            const BadgeIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 md:w-10 md:h-10 text-primary-dark"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 3 3 3 3 0 0 0 3-3V5a3 3 0 0 0-3-3z"/><path d="M7.74 15.39a8 8 0 1 0 8.51 0"/></svg>`;


            return `
                <div class="text-center">
                    <h1 class="text-4xl md:text-5xl font-extrabold text-secondary-yellow mb-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶§‡ßç‡¶¨‡ßá‡¶∞ ‡¶ß‡¶∞‡¶®</h1>
                    <p class="text-lg md:text-xl font-medium text-gray-300 mb-8">‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶§‡ßç‡¶¨‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</p>
                    
                    <div class="result-card p-6 md:p-10 rounded-2xl border-4 bg-primary-dark border-${themeColorClass} shadow-2xl">
                        
                        <!-- Personality Type Badge -->
                        <div class="inline-flex items-center justify-center p-4 md:p-6 bg-secondary-yellow rounded-full mb-6 transform rotate-[-1deg] shadow-xl">
                            <span class="text-3xl md:text-5xl font-black text-primary-dark">${result.type}</span>
                            <span class="ml-3">${BadgeIcon}</span>
                        </div>
                        
                        <h2 class="text-3xl md:text-4xl font-bold text-primary-light mb-2">
                            ${result.name} ${result.emoji}
                        </h2>
                        <p class="text-xl font-semibold text-${themeColorClass} mb-6">‡¶≠‡ßÇ‡¶Æ‡¶ø‡¶ï‡¶æ: ${result.role === 'Analyst' ? '‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶ï' : result.role === 'Diplomat' ? '‡¶ï‡ßÇ‡¶ü‡¶®‡ßÄ‡¶§‡¶ø‡¶ï' : result.role === 'Sentinel' ? '‡¶™‡ßç‡¶∞‡¶π‡¶∞‡ßÄ' : '‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ'}</p>
                        
                        <p class="text-base md:text-lg text-gray-300 mb-8 max-w-xl mx-auto border-t border-b border-${themeColorClass} py-4">
                            ${result.description}
                        </p>

                        <!-- Score Breakdown Section -->
                        <div class="mt-10 text-left max-w-xl mx-auto">
                            <h3 class="text-2xl font-bold mb-4 text-secondary-yellow border-b border-secondary-yellow pb-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶ï‡ßç‡¶∑‡ßÄ‡¶Ø‡¶º ‡¶∏‡ßç‡¶ï‡ßã‡¶∞</h3>
                            ${renderScoreBar(scores.EI, themeColorClass)}
                            ${renderScoreBar(scores.SN, themeColorClass)}
                            ${renderScoreBar(scores.TF, themeColorClass)}
                            ${renderScoreBar(scores.JP, themeColorClass)}
                        </div>
                        
                    </div>

                    <p class="mt-8 text-sm text-gray-500">
                        ‡¶è‡¶á ‡¶´‡¶≤‡¶æ‡¶´‡¶≤‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡ßá‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá ‡¶§‡ßà‡¶∞‡¶ø‡•§ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶§‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡•§
                    </p>
                    
                    <button
                        onclick="startQuiz()"
                        class="mt-6 px-8 py-4 bg-primary-light text-primary-dark font-bold text-lg rounded-xl hover:bg-white transition transform hover:scale-[1.03] shadow-lg"
                    >
                        ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶¶‡¶ø‡¶®
                    </button>
                    
                    <!-- Feedback Section - Small box -->
                    <div class="feedback-box mt-12 max-w-xs mx-auto text-center bg-primary-dark p-4 rounded-xl border border-secondary-yellow shadow-lg">
                        <p class="mb-2 text-sm text-gray-300">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ï‡ßá‡¶Æ‡¶® ‡¶≤‡ßá‡¶ó‡ßá‡¶õ‡ßá?</p>
                        <!-- Corrected/Confirmed Feedback Button -->
                        <button 
                            onclick="showFeedbackForm()" 
                            class="inline-block px-4 py-2 bg-secondary-yellow text-primary-dark font-bold text-sm rounded-lg hover:bg-yellow-400 transition transform hover:scale-105"
                            aria-label="Submit feedback"
                        >
                            ‡¶´‡¶ø‡¶°‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¶‡¶ø‡¶® ‚úâÔ∏è
                        </button>
                    </div>

                    <!-- Bottom Row for Navigation and Copyright -->
                    <div class="mt-4 flex justify-between items-center text-sm text-gray-500 border-t border-gray-800 pt-4">
                        <button onclick="goToHome()" class="text-gray-400 hover:text-secondary-yellow transition underline p-1 text-base font-semibold">
                            ‚Üê ‡¶π‡ßã‡¶Æ
                        </button>
                        <span>Developed by Biplob</span>
                    </div>
                </div>
            `;
        }

        function renderAdminLogin() {
            return `
                <div class="text-center p-8 md:p-12 max-w-sm mx-auto">
                    <h1 class="text-3xl font-extrabold text-secondary-yellow mb-6">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h1>
                    <p class="text-gray-400 mb-8">‡¶´‡¶ø‡¶°‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®‡•§</p>
                    
                    <div class="space-y-4">
                        <input type="text" id="admin-username" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ" class="w-full p-3 rounded-lg bg-primary-dark border border-2 border-gray-600 text-text-light focus:border-secondary-yellow outline-none" value="" />
                        <input type="password" id="admin-password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" class="w-full p-3 rounded-lg bg-primary-dark border border-2 border-gray-600 text-text-light focus:border-secondary-yellow outline-none" value="" />
                    </div>
                    
                    <button
                        onclick="loginAdmin()"
                        class="mt-8 w-full px-10 py-3 bg-secondary-yellow text-primary-dark font-bold text-lg rounded-xl shadow-lg hover:bg-yellow-400 transition transform hover:scale-[1.03]"
                    >
                        ‡¶≤‡¶ó‡¶á‡¶®
                    </button>
                    
                    <p id="admin-status" class="mt-4 text-center text-sm text-red-400 font-semibold"></p>
                </div>
                
                <!-- Footer Navigation -->
                <div class="mt-12 text-center text-sm text-gray-500 border-t border-gray-700 pt-4 flex justify-between items-center">
                    <button onclick="goToHome()" class="text-gray-400 hover:text-secondary-yellow transition underline p-1 text-base font-semibold">
                        ‚Üê ‡¶π‡ßã‡¶Æ
                    </button>
                    <span>Developed by Biplob</span>
                </div>
            `;
        }

        function renderAdminDashboard() {
            // Function to format time for readability
            const formatTime = (timestamp) => {
                if (!timestamp) return '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡ßá‡¶á';
                return new Date(timestamp).toLocaleString('bn-BD', {
                    year: 'numeric', month: 'short', day: 'numeric',
                    hour: '2-digit', minute: '2-digit', hour12: true
                });
            };

            const feedbackListHtml = state.feedbackList.length > 0
                ? state.feedbackList.map(f => {
                    const date = formatTime(f.timestamp);
                    
                    // All device/locale info data is intentionally removed from display for security/privacy
                    return `
                        <div class="bg-primary-dark p-4 rounded-xl mb-4 border border-secondary-yellow/30 shadow-md">
                            <div class="flex justify-between items-start text-secondary-yellow text-sm mb-2 border-b border-gray-700 pb-2">
                                <span class="font-bold text-xl text-primary-light">${f.name || 'Anonymous'}</span>
                                <div class="flex items-center space-x-2">
                                    <button 
                                        onclick="deleteFeedback('${f.id}')" 
                                        class="text-red-400 hover:text-red-500 transition px-3 py-1 rounded-lg border border-red-400 text-xs font-semibold"
                                        aria-label="Delete feedback ID: ${f.id}"
                                    >
                                        ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶® (üóëÔ∏è)
                                    </button>
                                </div>
                            </div>
                            <p class="text-base text-gray-200 whitespace-pre-wrap mb-3">${f.message}</p>
                            
                            <div class="mt-3 pt-3 border-t border-gray-800 text-xs text-gray-500 text-right">
                                <p class="text-xs text-gray-500">
                                    ‡¶∏‡¶Æ‡¶Ø‡¶º: <span class="text-gray-300 font-medium">${date}</span>
                                </p>
                            </div>
                        </div>
                    `;
                }).join('')
                : `<p class="text-center text-gray-400 p-8">‡¶è‡¶ñ‡¶® ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶ø‡¶°‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ú‡¶Æ‡¶æ ‡¶™‡ßú‡ßá‡¶®‡¶ø‡•§</p>`;

            return `
                <div class="p-4 md:p-6">
                    <h1 class="text-3xl font-extrabold text-secondary-yellow mb-8 border-b border-gray-700 pb-2">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h1>
                    
                    <!-- Total Uses Counter (Visible only to Admin) -->
                    <div class="mb-8 p-4 bg-[#2C6E70] rounded-xl shadow-inner flex justify-between items-center border border-secondary-yellow">
                        <span class="text-lg font-bold text-primary-light">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ (Total Uses):</span>
                        <span class="text-4xl font-extrabold text-secondary-yellow">${state.totalUses.toLocaleString('bn-BD')}</span>
                    </div>
                    <!-- End Total Uses Counter -->

                    <h2 class="text-xl font-bold text-primary-light mb-4">‡¶´‡¶ø‡¶°‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø (${state.feedbackList.length}‡¶ü‡¶ø)</h2>
                    
                    <div class="h-[400px] overflow-y-auto pr-2">
                        ${feedbackListHtml}
                    </div>

                    <p class="mt-8 text-sm text-gray-500 border-t border-gray-700 pt-4">
                        ‡¶¶‡ßç‡¶∞‡¶∑‡ßç‡¶ü‡¶¨‡ßç‡¶Ø: ‡¶è‡¶á ‡¶´‡¶ø‡¶°‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§
                    </p>
                </div>
                
                <!-- Footer Navigation -->
                <div class="mt-4 flex justify-between items-center text-sm text-gray-500 border-t border-gray-800 pt-4">
                    <button onclick="goToHome()" class="text-gray-400 hover:text-secondary-yellow transition underline p-1 text-base font-semibold">
                        ‚Üê ‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü ‡¶ì ‡¶π‡ßã‡¶Æ
                    </button>
                    <span>Developed by Biplob</span>
                </div>
            `;
        }

        // Setup feedback listener for admin dashboard
        function setupFeedbackListener() {
            if (!state.firebaseInitialized || !state.isAdminLoggedIn) return;
            
            if (unsubscribeFeedback) unsubscribeFeedback(); 

            const feedbackQuery = query(
                collection(db, FEEDBACK_COLLECTION),
            );

            unsubscribeFeedback = onSnapshot(feedbackQuery, (snapshot) => {
                const feedbackData = [];
                snapshot.forEach(doc => {
                    feedbackData.push({ id: doc.id, ...doc.data() });
                });
                
                feedbackData.sort((a, b) => b.timestamp - a.timestamp);
                
                state.feedbackList = feedbackData;
                if (state.view === 'admin_dashboard') render();
            }, (error) => {
                console.error("Error setting up feedback listener:", error);
                state.feedbackList = [{ id: 'error', name: 'ERROR', message: '‡¶´‡¶ø‡¶°‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§', timestamp: new Date() }];
                if (state.view === 'admin_dashboard') render();
            });
        }
        
        async function deleteFeedback(feedbackId) {
            if (!state.isAdminLoggedIn || !db) {
                console.error("Not authorized or database not ready to delete.");
                return;
            }
            
            try {
                const docRef = doc(db, FEEDBACK_COLLECTION, feedbackId);
                await deleteDoc(docRef);
                console.log("Feedback deleted successfully:", feedbackId);
            } catch (error) {
                console.error("Error deleting feedback:", error);
            }
        }
        window.deleteFeedback = deleteFeedback;
        
        // --- ADMIN BUTTON VISIBILITY CONTROL ---
        function updateAdminButtonVisibility() {
            const btn = document.getElementById('admin-toggle-btn');
            if (!btn) return;

            // Show the subtle 'A' button ONLY on user-facing views
            if (state.view === 'welcome' || state.view === 'quiz' || state.view === 'result') {
                btn.classList.remove('hidden');
            } else {
                // Hide it on admin-specific pages
                btn.classList.add('hidden');
            }
        }

        // Main render function
        function render() {
            if (state.view === 'welcome') {
                appDiv.innerHTML = renderWelcome();
            } else if (state.view === 'quiz') {
                appDiv.innerHTML = renderQuiz();
                setTimeout(() => {
                    const contentDiv = document.getElementById('question-content');
                    if (contentDiv) {
                        contentDiv.classList.remove('animate-out');
                        contentDiv.style.transform = 'translateX(0)'; 
                    }
                }, 50);
            } else if (state.view === 'result') {
                appDiv.innerHTML = renderResult();
            } else if (state.view === 'admin_login') {
                appDiv.innerHTML = renderAdminLogin();
            } else if (state.view === 'admin_dashboard' && state.isAdminLoggedIn) {
                appDiv.innerHTML = renderAdminDashboard();
            } else {
                 goToHome();
            }
            
            // Final step: update button visibility based on the current view
            updateAdminButtonVisibility();
        }
        
        // --- INITIALIZATION ---
        // OPTIMIZATION: Call render immediately to show UI content instantly (Perceived performance)
        document.addEventListener('DOMContentLoaded', () => {
            render(); 
            // Then start the heavy-lifting (Firebase initialization)
            initializeFirebase(); 
        });
    </script>
</body>
</html>
